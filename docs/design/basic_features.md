# 基本機能設計書

## 1. 概要
本ドキュメントは、ウェブベースのマインドマップアプリケーション「Kakidashi Board」の基本機能に関する要件と設計を定義します。
ユーザーが直感的に思考を整理・マッピングできるツールを目指します。

## 2. コア概念

### 2.1 ノード (Node)
マインドマップ上の情報の単位。
- **属性**:
    - ID (一意の識別子)
    - テキスト内容
    - 位置座標 (X, Y)
    - サイズ (幅, 高さ)
    - スタイル (色, 形状)

### 2.2 エッジ (Edge)
ノード間を接続するライン。関係性を表現します。
- **属性**:
    - ID
    - ソースノードID (親)
    - ターゲットノードID (子)
    - スタイル (線の種類, 太さ)

### 2.3 ボード (Board)
すべてのノードとエッジを配置する無限のキャンバス。
- **属性**:
    - ビューポートの状態 (ズームレベル, 中心座標)

## 3. 機能要件

### 3.1 ノード管理機能
- **ノード追加**:
    - 任意の位置にルートノードを作成できる。
    - 既存ノードに対して、子ノードまたは兄弟ノードを追加できる。
- **ノード編集**:
    - ノード内のテキストを編集できる。
- **ノード移動**:
    - ドラッグ＆ドロップでノードの位置を変更できる。
    - (将来要件) 子ノードを含めたサブツリー全体の移動。
- **ノード削除**:
    - 選択したノードを削除できる。
    - 削除対象が親ノードの場合、接続された子ノードの扱い（連鎖削除または接続解除）を考慮する。初期実装では連鎖削除とする。
- **ノードのコピー/カット＆ペースト**:
    - 選択したノード（およびそのサブツリー）をクリップボードにコピー/カットできる。
    - 別のノードを選択してペーストすることで、そのノードの子として追加・移動できる。


### 3.2 接続（エッジ）管理機能
- **自動接続**:
    - 子ノード追加時に自動的に親ノードとエッジで接続される。
- **関係編集**:
    - ノードをドラッグして別のノードにドロップすることで、親ノードを変更（付け替え）できる。

### 3.3 キャンバス操作機能
- **パン (Panning)**:
    - 背景をドラッグ、またはスペースキー＋ドラッグでキャンバス表示領域を移動できる。
- **ズーム (Zooming)**:
    - マウスホイール、またはズームコントローラで表示倍率を変更できる。

### 3.4 データ永続化
- **保存**:
    - 現在の編集状態（ノード配置、接続、テキスト）を保存できる。
    - 初期実装ではブラウザのLocal Storage、またはJSONファイルへのエクスポートを提供する。
- **読み込み**:
    - 保存されたデータを復元できる。

### 3.5 設定機能
- **ショートカットキー設定**:
    - 各操作に割り当てられたキーバインディングをユーザーが変更できる。


## 4. UI/UX ガイドライン

### 4.1 インタラクション
- マウス操作を基本としつつ、思考を妨げないキーボード操作を重視する。

### 4.2 ショートカットキー (案)
- `Enter`: 兄弟ノードを追加 (下)
- `Shift` + `Enter`: 兄弟ノードを追加 (上)
- `Tab`: 子ノードを追加
- `Shift` + `Tab`: 親ノードと自ノードの間にノードを挿入
- `F2`: ノードのテキストを編集開始
- `Esc`: ノード編集のキャンセル
- `Delete` / `Backspace`: ノード削除
- `Space` + Drag: キャンバス移動
- `Ctrl` / `Cmd` + `Z`: 取り消し (Undo)
- `Ctrl` / `Cmd` + `Shift` + `Z`: やり直し (Redo)
- `Ctrl` / `Cmd` + `C`: コピー
- `Ctrl` / `Cmd` + `X`: カット
- `Ctrl` / `Cmd` + `V`: ペースト


※ ショートカットキーは設定画面でカスタマイズ可能とする。

## 5. アーキテクチャへの影響 (Clean Architecture)

### 5.1 Entities
ドメインルールをカプセル化した以下のエンティティが必要となります。

- `MindMap`: 集約ルート。ノードとエッジのコレクションを管理し、整合性を保つ。
- `Node`: ノードの座標やコンテンツを保持。
- `Edge`: ノード間の接続関係を保持。

### 5.2 Use Cases
各機能要件に対応するユースケースを実装します。
- `AddNodeUseCase`
- `MoveNodeUseCase`
- `EditNodeTextUseCase`
- `DeleteNodeUseCase`
- `LoadMindMapUseCase`
- `SaveMindMapUseCase`

### 5.3 Interface Adapters
- **Repository Interface**: データの保存・読み込みを抽象化する (`MindMapRepository`).
- **Presenter**: マインドマップの状態をViewに適した形式に変換する。
